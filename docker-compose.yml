services:
  dashboard:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        DASHBOARD_FEATURES: "with-simulator"
    ports:
      - "3000:3000"
    environment:
      - HIQ_BIND=0.0.0.0:3000
      - RUST_LOG=hiq_dashboard=info,tower_http=debug
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:3000/api/health"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 5s

  # One-off CLI commands:
  #   docker compose run --rm cli compile examples/bell.qasm --target simulator
  cli:
    build:
      context: .
      dockerfile: Dockerfile
    entrypoint: ["hiq"]
    environment:
      - RUST_LOG=info
    volumes:
      - ./examples:/home/hiq/local-examples:ro
    profiles:
      - cli

  # Run demos:
  #   docker compose run --rm demo demo-grover
  #   docker compose run --rm demo demo-vqe
  #   docker compose run --rm demo demo-qaoa
  #   docker compose run --rm demo demo-all
  #   docker compose run --rm demo lumi_vqe --mode local
  demo:
    build:
      context: .
      dockerfile: Dockerfile
    entrypoint: []
    environment:
      - RUST_LOG=info
    profiles:
      - demo
